<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reservas - Peluquería</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style id="app-style">
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .slide-in {
      animation: slideIn 0.5s ease-in-out;
    }
    
    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .reservation-card:hover {
      transform: translateY(-2px);
      transition: transform 0.3s ease;
    }
    
    .time-slot-button.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .success-message {
      transform: scale(0);
      animation: popIn 0.5s forwards;
    }
    
    @keyframes popIn {
      0% { transform: scale(0); }
      70% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <!-- Header -->
  <header class="bg-white shadow">
    <div class="container mx-auto px-4 py-6 flex justify-between items-center">
      <h1 class="text-3xl font-bold text-gray-800">
        <i class="fas fa-cut mr-2"></i>Reservas
      </h1>
      <button id="admin-button" class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition">
        <i class="fas fa-user-lock mr-2"></i>Panel Admin
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">
    <!-- Client Form Section -->
    <section id="client-section" class="fade-in">
      <div class="bg-white rounded-lg shadow-lg p-6 md:p-8 max-w-2xl mx-auto">
        <h2 class="text-2xl font-semibold text-gray-800 mb-6">Reserva tu cita</h2>
        
        <form id="reservation-form" class="space-y-6">
          <div>
            <label for="fullname" class="block text-gray-700 font-medium mb-2">Nombre completo</label>
            <input type="text" id="fullname" name="fullname" required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          
          <div>
            <label for="phone" class="block text-gray-700 font-medium mb-2">Teléfono</label>
            <input type="tel" id="phone" name="phone" required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          
          <div>
            <label for="date" class="block text-gray-700 font-medium mb-2">Fecha</label>
            <input type="text" id="date" name="date" required placeholder="Selecciona una fecha"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          
          <div>
            <label class="block text-gray-700 font-medium mb-2">Hora</label>
            <div id="time-slots" class="grid grid-cols-3 gap-2">
              <!-- Time slots will be generated by JavaScript -->
            </div>
          </div>
          
          <div>
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-medium transition">
              <i class="fas fa-calendar-check mr-2"></i>Confirmar Reserva
            </button>
          </div>
        </form>
        
        <!-- Success message (hidden by default) -->
        <div id="success-message" class="hidden mt-6 p-4 bg-green-100 border border-green-200 text-green-700 rounded-lg text-center">
          <i class="fas fa-check-circle text-xl mr-2"></i>
          <span class="font-medium">¡Tu reserva se ha realizado con éxito!</span>
        </div>
      </div>
    </section>
    
    <!-- Admin Login Modal (hidden by default) -->
    <div id="admin-login-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md slide-in">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold text-gray-800">Acceso Administrador</h3>
          <button id="close-login-modal" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        
        <form id="admin-login-form" class="space-y-4">
          <div>
            <label for="password" class="block text-gray-700 font-medium mb-2">Contraseña</label>
            <input type="password" id="password" name="password" required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          
          <div id="login-error" class="hidden text-red-600 text-sm">
            <i class="fas fa-exclamation-circle mr-1"></i>Contraseña incorrecta
          </div>
          
          <div>
            <button type="submit" class="w-full bg-gray-800 hover:bg-gray-700 text-white py-2 px-4 rounded-lg font-medium transition">
              <i class="fas fa-sign-in-alt mr-2"></i>Acceder
            </button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Admin Panel Section (hidden by default) -->
    <section id="admin-section" class="hidden fade-in">
      <div class="bg-white rounded-lg shadow-lg p-6 md:p-8 max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-semibold text-gray-800">Panel de Administración</h2>
          <button id="back-to-client" class="text-blue-600 hover:text-blue-800 font-medium">
            <i class="fas fa-arrow-left mr-2"></i>Volver a Cliente
          </button>
        </div>
        
        <!-- Admin Tabs -->
        <div class="border-b border-gray-200 mb-6">
          <div class="flex space-x-4">
            <button id="tab-reservations" class="px-4 py-2 text-blue-600 border-b-2 border-blue-600 font-medium">Reservas</button>
            <button id="tab-disabled-dates" class="px-4 py-2 text-gray-500 hover:text-gray-700 font-medium">Fechas Deshabilitadas</button>
          </div>
        </div>
        
        <!-- Reservations Tab (visible by default) -->
        <div id="reservations-tab-content">
          <div class="overflow-x-auto">
            <table class="min-w-full bg-white">
              <thead class="bg-gray-100">
                <tr>
                  <th class="py-3 px-4 text-left text-gray-700 font-medium">Nombre</th>
                  <th class="py-3 px-4 text-left text-gray-700 font-medium">Teléfono</th>
                  <th class="py-3 px-4 text-left text-gray-700 font-medium">Fecha</th>
                  <th class="py-3 px-4 text-left text-gray-700 font-medium">Hora</th>
                  <th class="py-3 px-4 text-right text-gray-700 font-medium">Acciones</th>
                </tr>
              </thead>
              <tbody id="reservations-table-body">
                <!-- Reservations will be listed here by JavaScript -->
              </tbody>
            </table>
          </div>
          
          <div id="no-reservations" class="hidden text-center py-8 text-gray-500">
            <i class="fas fa-calendar-times text-4xl mb-3"></i>
            <p>No hay reservas registradas</p>
          </div>
        </div>
        
        <!-- Disabled Dates Tab (hidden by default) -->
        <div id="disabled-dates-tab-content" class="hidden">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h3 class="text-lg font-medium text-gray-800 mb-4">Deshabilitar fechas</h3>
              <form id="disable-date-form" class="space-y-4">
                <div>
                  <label for="disabled-date" class="block text-gray-700 font-medium mb-2">Seleccionar fecha</label>
                  <input type="text" id="disabled-date" name="disabled-date" placeholder="Selecciona una fecha"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                  <button type="submit" class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium transition">
                    <i class="fas fa-ban mr-2"></i>Deshabilitar Fecha
                  </button>
                </div>
              </form>
            </div>
            
            <div>
              <h3 class="text-lg font-medium text-gray-800 mb-4">Fechas deshabilitadas</h3>
              <div id="disabled-dates-list" class="space-y-2">
                <!-- Disabled dates will be listed here by JavaScript -->
              </div>
              <div id="no-disabled-dates" class="text-center py-4 text-gray-500">
                <p>No hay fechas deshabilitadas</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Disable Hours Section -->
        <div id="disable-hours-section" class="mt-8">
          <h3 class="text-lg font-medium text-gray-800 mb-4">Deshabilitar Horas</h3>
          <form id="disable-hours-form" class="space-y-4 bg-gray-50 p-4 rounded-lg">
            <div>
              <label for="disabled-hours-date" class="block text-gray-700 font-medium mb-2">Seleccionar fecha</label>
              <input type="text" id="disabled-hours-date" name="disabled-hours-date" placeholder="Selecciona una fecha"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div id="hours-checkboxes" class="grid grid-cols-3 gap-2 max-h-64 overflow-auto"></div>
            <div>
              <button type="submit" class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium transition">
                <i class="fas fa-clock mr-2"></i>Deshabilitar Horas
              </button>
            </div>
          </form>

          <div id="disabled-hours-list" class="mt-6 space-y-2">
            <!-- will be populated by JS -->
          </div>
          <div id="no-disabled-hours" class="text-center py-4 text-gray-500">
            <p>No hay horas deshabilitadas</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-6 mt-12">
    <div class="container mx-auto px-4 text-center">
      <p>© 2025 Reservas Peluquería. Todos los derechos reservados.</p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
  
  <script id="app-script">
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize state
      let selectedTime = null;
      const workingHours = {
        start: 9, // 9 AM
        end: 18 // 6 PM
      };
      
      // DOM Elements
      const clientSection = document.getElementById('client-section');
      const adminSection = document.getElementById('admin-section');
      const adminButton = document.getElementById('admin-button');
      const adminLoginModal = document.getElementById('admin-login-modal');
      const closeLoginModalButton = document.getElementById('close-login-modal');
      const adminLoginForm = document.getElementById('admin-login-form');
      const loginErrorMessage = document.getElementById('login-error');
      const backToClientButton = document.getElementById('back-to-client');
      const reservationForm = document.getElementById('reservation-form');
      const timeSlots = document.getElementById('time-slots');
      const successMessage = document.getElementById('success-message');
      const tabReservations = document.getElementById('tab-reservations');
      const tabDisabledDates = document.getElementById('tab-disabled-dates');
      const reservationsTabContent = document.getElementById('reservations-tab-content');
      const disabledDatesTabContent = document.getElementById('disabled-dates-tab-content');
      const reservationsTableBody = document.getElementById('reservations-table-body');
      const noReservationsMessage = document.getElementById('no-reservations');
      const disableDateForm = document.getElementById('disable-date-form');
      const disabledDatesList = document.getElementById('disabled-dates-list');
      const noDisabledDatesMessage = document.getElementById('no-disabled-dates');
      
      // Initialize LocalStorage if needed
      if (!localStorage.getItem('reservations')) {
        localStorage.setItem('reservations', JSON.stringify([]));
      }
      
      if (!localStorage.getItem('disabledDates')) {
        localStorage.setItem('disabledDates', JSON.stringify([]));
      }
      
      if (!localStorage.getItem('disabledHours')) {
        localStorage.setItem('disabledHours', JSON.stringify([]));
      }
      
      // Initialize Flatpickr for client date selection
      const datePickr = flatpickr('#date', {
        locale: 'es',
        dateFormat: 'd/m/Y',
        minDate: 'today',
        disable: getDisabledDates(),
        onChange: function(selectedDates) {
          if (selectedDates.length > 0) {
            lastClientDate = selectedDates[0];
            generateTimeSlots(selectedDates[0]);
          }
        }
      });
      
      // Initialize Flatpickr for admin disabled dates
      const disabledDatePickr = flatpickr('#disabled-date', {
        locale: 'es',
        dateFormat: 'd/m/Y',
        minDate: 'today'
      });
      
      // Initialize Flatpickr for admin disabled hours
      const disabledHoursPickr = flatpickr('#disabled-hours-date', {
        locale: 'es',
        dateFormat: 'd/m/Y',
        minDate: 'today',
        onChange(selectedDates) {
          if (selectedDates.length) {
            renderHoursCheckboxes(selectedDates[0]);
          }
        }
      });
      
      // Store last selected client date so we can re-render later
      let lastClientDate = null;
      
      // Functions
      function getDisabledDates() {
        const disabledDates = JSON.parse(localStorage.getItem('disabledDates')) || [];
        return disabledDates;
      }
      
      function getDisabledHours() {
        return JSON.parse(localStorage.getItem('disabledHours')) || [];
      }
      
      function formatDateKey(date) {
        const d = date.getDate().toString().padStart(2,'0');
        const m = (date.getMonth()+1).toString().padStart(2,'0');
        const y = date.getFullYear();
        return `${d}/${m}/${y}`;
      }
      
      function renderHoursCheckboxes(date) {
        const container = document.getElementById('hours-checkboxes');
        container.innerHTML = '';
        const key = formatDate(date);            // <-- ensure same formatting
        const existingEntry = getDisabledHours().find(e => e.date === key) || { hours: [] };
        const existing = existingEntry.hours;
        
        for (let h=9; h<18; h++) {
          [0,45].forEach(min=>{
            if (h===17 && min===45) return;
            const time = `${h.toString().padStart(2,'0')}:${min.toString().padStart(2,'0')}`;
            const id = `chk-${key}-${time.replace(':','')}`;
            const checked = existing.includes(time) ? 'checked' : '';
            container.insertAdjacentHTML('beforeend', `
              <label for="${id}" class="flex items-center space-x-2">
                <input type="checkbox" id="${id}" value="${time}" ${checked}
                  class="form-checkbox h-4 w-4 text-red-600" />
                <span class="text-gray-700">${time}</span>
              </label>
            `);
          });
        }
      }
      
      function generateTimeSlots(date) {
        // Clear previous time slots
        timeSlots.innerHTML = '';
        selectedTime = null;
        
        // Get all reservations for the selected date
        const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
        const dateString = formatDate(date);
        const reservedTimes = reservations
          .filter(res => res.date === dateString)
          .map(res => res.time);
        
        // Get all disabled hours for the selected date
        const dh = (getDisabledHours().find(e=>e.date===dateString)||{hours:[]}).hours;
        
        // Generate time slots (45 minute intervals)
        for (let hour = workingHours.start; hour < workingHours.end; hour++) {
          for (let minutes of [0, 45]) {
            if (hour === workingHours.end - 1 && minutes === 45) continue; // Skip last slot if it goes beyond end time
            
            const timeString = formatTime(hour, minutes);
            const isReserved = reservedTimes.includes(timeString);
            const isDisabledHour = dh.includes(timeString);
            const disabledOrReserved = isReserved || isDisabledHour;
            
            const timeButton = document.createElement('button');
            timeButton.type = 'button';
            timeButton.className = `time-slot-button p-2 border rounded-lg text-center transition ${
              disabledOrReserved ? 'bg-gray-200 text-gray-500 disabled' : 'bg-white hover:bg-blue-50 hover:border-blue-300'
            }`;
            timeButton.textContent = timeString;
            
            if (!disabledOrReserved) {
              timeButton.addEventListener('click', function() {
                // Remove selection from all buttons
                document.querySelectorAll('.time-slot-button').forEach(btn => {
                  btn.classList.remove('bg-blue-500', 'text-white');
                  btn.classList.add('bg-white');
                });
                
                // Add selection to this button
                timeButton.classList.remove('bg-white');
                timeButton.classList.add('bg-blue-500', 'text-white');
                
                selectedTime = timeString;
              });
            }
            
            timeSlots.appendChild(timeButton);
          }
        }
      }
      
      function formatDate(date) {
        const day = date.getDate().toString().padStart(2, '0');
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
      }
      
      function formatTime(hour, minutes) {
        return `${hour.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
      }
      
      function loadReservations() {
        const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
        reservationsTableBody.innerHTML = '';
        
        if (reservations.length === 0) {
          noReservationsMessage.classList.remove('hidden');
          return;
        }
        
        noReservationsMessage.classList.add('hidden');
        
        reservations.forEach((reservation, index) => {
          const row = document.createElement('tr');
          row.className = 'border-b hover:bg-gray-50';
          
          row.innerHTML = `
            <td class="py-3 px-4">${reservation.fullname}</td>
            <td class="py-3 px-4">${reservation.phone}</td>
            <td class="py-3 px-4">${reservation.date}</td>
            <td class="py-3 px-4">${reservation.time}</td>
            <td class="py-3 px-4 text-right">
              <button class="delete-reservation text-red-600 hover:text-red-800" data-index="${index}">
                <i class="fas fa-trash-alt"></i>
              </button>
            </td>
          `;
          
          reservationsTableBody.appendChild(row);
        });
        
        // Add event listeners to delete buttons
        document.querySelectorAll('.delete-reservation').forEach(button => {
          button.addEventListener('click', function() {
            const index = parseInt(this.getAttribute('data-index'));
            deleteReservation(index);
          });
        });
      }
      
      function deleteReservation(index) {
        const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
        reservations.splice(index, 1);
        localStorage.setItem('reservations', JSON.stringify(reservations));
        loadReservations();
      }
      
      function loadDisabledDates() {
        const disabledDates = JSON.parse(localStorage.getItem('disabledDates')) || [];
        disabledDatesList.innerHTML = '';
        
        if (disabledDates.length === 0) {
          noDisabledDatesMessage.classList.remove('hidden');
          return;
        }
        
        noDisabledDatesMessage.classList.add('hidden');
        
        disabledDates.forEach((date, index) => {
          const dateItem = document.createElement('div');
          dateItem.className = 'flex justify-between items-center p-3 bg-gray-50 rounded-lg';
          
          dateItem.innerHTML = `
            <span>${date}</span>
            <button class="remove-disabled-date text-red-600 hover:text-red-800" data-index="${index}">
              <i class="fas fa-times"></i>
            </button>
          `;
          
          disabledDatesList.appendChild(dateItem);
        });
        
        // Add event listeners to remove buttons
        document.querySelectorAll('.remove-disabled-date').forEach(button => {
          button.addEventListener('click', function() {
            const index = parseInt(this.getAttribute('data-index'));
            removeDisabledDate(index);
          });
        });
      }
      
      function removeDisabledDate(index) {
        const disabledDates = JSON.parse(localStorage.getItem('disabledDates')) || [];
        disabledDates.splice(index, 1);
        localStorage.setItem('disabledDates', JSON.stringify(disabledDates));
        
        // Update flatpickr disabled dates
        datePickr.set('disable', disabledDates);
        
        loadDisabledDates();
      }
      
      function loadDisabledHoursList() {
        const list = document.getElementById('disabled-hours-list');
        const empty = document.getElementById('no-disabled-hours');
        const data = getDisabledHours();
        list.innerHTML = '';
        if (!data.length) {
          empty.classList.remove('hidden');
          return;
        }
        empty.classList.add('hidden');
        data.forEach((entry, idx)=>{
          const html = `
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
              <div>
                <span class="font-medium">${entry.date}</span>:
                <span>${entry.hours.join(', ')}</span>
              </div>
              <button data-index="${idx}" class="remove-disabled-hour text-red-600 hover:text-red-800">
                <i class="fas fa-times"></i>
              </button>
            </div>`;
          list.insertAdjacentHTML('beforeend', html);
        });
        document.querySelectorAll('.remove-disabled-hour').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const idx = parseInt(btn.getAttribute('data-index'));
            const arr = getDisabledHours();
            arr.splice(idx,1);
            localStorage.setItem('disabledHours', JSON.stringify(arr));
            loadDisabledHoursList();
          });
        });
      }
      
      // Event Listeners
      adminButton.addEventListener('click', function() {
        adminLoginModal.classList.remove('hidden');
      });
      
      closeLoginModalButton.addEventListener('click', function() {
        adminLoginModal.classList.add('hidden');
        loginErrorMessage.classList.add('hidden');
        adminLoginForm.reset();
      });
      
      adminLoginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const password = document.getElementById('password').value;
        
        if (password === '1234') {
          adminLoginModal.classList.add('hidden');
          clientSection.classList.add('hidden');
          adminSection.classList.remove('hidden');
          adminLoginForm.reset();
          loginErrorMessage.classList.add('hidden');
          
          // Load data for admin panel
          loadReservations();
          loadDisabledDates();
          loadDisabledHoursList();
        } else {
          loginErrorMessage.classList.remove('hidden');
        }
      });
      
      backToClientButton.addEventListener('click', function() {
        adminSection.classList.add('hidden');
        clientSection.classList.remove('hidden');
      });
      
      reservationForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const fullname = document.getElementById('fullname').value;
        const phone = document.getElementById('phone').value;
        const date = document.getElementById('date').value;
        
        if (!selectedTime) {
          alert('Por favor, selecciona una hora para tu cita.');
          return;
        }
        
        // Create new reservation
        const newReservation = {
          fullname,
          phone,
          date,
          time: selectedTime
        };
        
        // Save to localStorage
        const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
        reservations.push(newReservation);
        localStorage.setItem('reservations', JSON.stringify(reservations));
        
        // Show success message
        successMessage.classList.remove('hidden');
        successMessage.classList.add('success-message');
        
        // Reset form
        reservationForm.reset();
        timeSlots.innerHTML = '';
        selectedTime = null;
        
        // Hide success message after a few seconds
        setTimeout(() => {
          successMessage.classList.add('hidden');
          successMessage.classList.remove('success-message');
        }, 3000);
      });
      
      tabReservations.addEventListener('click', function() {
        tabReservations.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
        tabReservations.classList.remove('text-gray-500');
        
        tabDisabledDates.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
        tabDisabledDates.classList.add('text-gray-500');
        
        reservationsTabContent.classList.remove('hidden');
        disabledDatesTabContent.classList.add('hidden');
      });
      
      tabDisabledDates.addEventListener('click', function() {
        tabDisabledDates.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
        tabDisabledDates.classList.remove('text-gray-500');
        
        tabReservations.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
        tabReservations.classList.add('text-gray-500');
        
        disabledDatesTabContent.classList.remove('hidden');
        reservationsTabContent.classList.add('hidden');
      });
      
      disableDateForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const disabledDate = document.getElementById('disabled-date').value;
        
        if (!disabledDate) {
          alert('Por favor, selecciona una fecha para deshabilitar.');
          return;
        }
        
        // Save to localStorage
        const disabledDates = JSON.parse(localStorage.getItem('disabledDates')) || [];
        
        // Check if date is already disabled
        if (disabledDates.includes(disabledDate)) {
          alert('Esta fecha ya está deshabilitada.');
          return;
        }
        
        disabledDates.push(disabledDate);
        localStorage.setItem('disabledDates', JSON.stringify(disabledDates));
        
        // Update flatpickr disabled dates
        datePickr.set('disable', disabledDates);
        
        // Reset form and reload list
        disableDateForm.reset();
        loadDisabledDates();
      });
      
      adminLoginForm.addEventListener('submit', function(e){
        e.preventDefault();
        loadDisabledHoursList();
      });
      
      tabDisabledDates.addEventListener('click', loadDisabledHoursList);
      
      // In the admin disable‐hours submission:
      const disableHoursForm = document.getElementById('disable-hours-form');
      disableHoursForm.addEventListener('submit', function(e) {
        e.preventDefault();

        const dateStr = document.getElementById('disabled-hours-date').value;
        // gather checked hours
        const checked = Array.from(
          document.querySelectorAll('#hours-checkboxes input:checked')
        ).map(i => i.value);

        // Save to localStorage
        const arr = getDisabledHours();
        // remove any existing entry for this date
        const filtered = arr.filter(x => x.date !== dateStr);
        filtered.push({ date: dateStr, hours: checked });
        localStorage.setItem('disabledHours', JSON.stringify(filtered));

        // reload admin list
        loadDisabledHoursList();

        // 1) If client has this same date selected, refresh its slots:
        if (lastClientDate && formatDate(lastClientDate) === dateStr) {
          generateTimeSlots(lastClientDate);
        }

        // reset form
        disableHoursForm.reset();
      });
    });
  </script>
  <script>
  const form = document.getElementById('form');
  const mensaje = document.getElementById('mensaje');

  form.addEventListener('submit', function(e) {
    e.preventDefault();

    const nombre = document.getElementById('nombre').value.trim();
    const telefono = document.getElementById('telefono').value.trim();
    const fecha = document.getElementById('fecha').value;
    const hora = document.getElementById('hora').value;

    const datos = { nombre, telefono, fecha, hora };

    fetch("https://script.google.com/macros/s/AKfycbzjSUrE-_l0bINWjh_wjk6F2FCGYZmrzNl6rJLoNnN5NMOzejWeuU3T3RfUCg26yAmsAQ/exec", {
      method: "POST",
      body: JSON.stringify(datos),
      headers: {
        "Content-Type": "application/json"
      }
    })
    .then(res => res.text())
    .then(msg => {
      console.log(msg);
      mensaje.classList.remove('hidden');
      form.reset();
      setTimeout(() => mensaje.classList.add('hidden'), 3000);
    })
    .catch(err => {
      console.error(err);
      alert("Error al enviar la reserva");
    });
  });
</script>
</body>
</html>
